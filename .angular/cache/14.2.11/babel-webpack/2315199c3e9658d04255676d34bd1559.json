{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Usuario/Documents/Work/sgp/GestionDeProyectos.2023.DEV/MigracionAngular14/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FilterProject } from '../../model/project/filterproject';\nimport Swal from 'sweetalert2';\nimport { User } from 'src/app/layout/manage/model/user/user';\nimport { RegistroPagosComponent } from '../registro-pagos/registro-pagos.component';\nimport { Workbook } from 'exceljs';\nimport * as fs from 'file-saver';\nimport { lastValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-spinner\";\nimport * as i2 from \"../../services/project/project.service\";\nimport * as i3 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i4 from \"../../services/client/client.service\";\nimport * as i5 from \"../../services/person/person.service\";\nimport * as i6 from \"../../services/common/permiso.service\";\nimport * as i7 from \"../../services/project/projecttype.service\";\nimport * as i8 from \"../../services/common/mastertable.service\";\nimport * as i9 from \"@angular/material/dialog\";\nimport * as i10 from \"@angular/router\";\nimport * as i11 from \"@angular/common\";\nimport * as i12 from \"@angular/forms\";\n\nfunction FacturacionProyectosComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 50);\n    i0.ɵɵtext(1, \"No hay filtros disponible para el usuario\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_ng_template_11_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r20 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r20.code);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r20.description, \"\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_ng_template_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 53)(1, \"label\");\n    i0.ɵɵtext(2, \"Responsable Proyecto\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 57);\n    i0.ɵɵlistener(\"ngModelChange\", function FacturacionProyectosComponent_ng_template_29_ng_template_11_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r21 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r21.filterProject.nid_manager = $event);\n    });\n    i0.ɵɵelementStart(4, \"option\", 58);\n    i0.ɵɵtext(5, \"-- Seleccione --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, FacturacionProyectosComponent_ng_template_29_ng_template_11_option_6_Template, 2, 2, \"option\", 59);\n    i0.ɵɵelementStart(7, \"span\", 61);\n    i0.ɵɵtext(8, \"El campo Responsable Proyecto es obligatorio\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r12.filterProject.nid_manager);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r12.PersonDropDownList);\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_option_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r23 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r23.code);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r23.description, \"\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_option_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r24 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r24.nid_client);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", item_r24.sname, \" - \", item_r24.sbusinessname, \"\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_option_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r25 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r25.nid_mastertable_type);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r25.sshort_value, \"\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 53)(1, \"label\");\n    i0.ɵɵtext(2, \"\\u00A0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 64)(4, \"button\", 65);\n    i0.ɵɵlistener(\"click\", function FacturacionProyectosComponent_ng_template_29_div_36_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r26 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r26.search());\n    });\n    i0.ɵɵelement(5, \"i\", 66);\n    i0.ɵɵtext(6, \"\\u00A0Consultar \");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r29 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 53)(1, \"label\");\n    i0.ɵɵtext(2, \"\\u00A0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 64)(4, \"button\", 65);\n    i0.ɵɵlistener(\"click\", function FacturacionProyectosComponent_ng_template_29_div_37_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r29);\n      const ctx_r28 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r28.projectIngresosList());\n    });\n    i0.ɵɵelement(5, \"i\", 66);\n    i0.ɵɵtext(6, \"\\u00A0Ingresos \");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r31 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 53)(1, \"label\");\n    i0.ɵɵtext(2, \"\\u00A0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 64)(4, \"button\", 65);\n    i0.ɵɵlistener(\"click\", function FacturacionProyectosComponent_ng_template_29_div_38_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r31);\n      const ctx_r30 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r30.projectGastosList());\n    });\n    i0.ɵɵelement(5, \"i\", 66);\n    i0.ɵɵtext(6, \"\\u00A0Gastos \");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tbody\")(1, \"tr\")(2, \"div\", 25)(3, \"div\", 51)(4, \"div\", 52)(5, \"div\", 13)(6, \"div\", 53)(7, \"label\");\n    i0.ɵɵtext(8, \"C\\u00F3digo Proyecto \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"input\", 54);\n    i0.ɵɵlistener(\"ngModelChange\", function FacturacionProyectosComponent_ng_template_29_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r32 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r32.filterProject.scodproject = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(10, FacturacionProyectosComponent_ng_template_29_div_10_Template, 1, 0, \"div\", 55);\n    i0.ɵɵtemplate(11, FacturacionProyectosComponent_ng_template_29_ng_template_11_Template, 9, 2, \"ng-template\", null, 56, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementStart(13, \"div\", 53)(14, \"label\");\n    i0.ɵɵtext(15, \"Tipo Proyecto \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"select\", 57);\n    i0.ɵɵlistener(\"ngModelChange\", function FacturacionProyectosComponent_ng_template_29_Template_select_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r34 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r34.filterProject.nid_project_type = $event);\n    });\n    i0.ɵɵelementStart(17, \"option\", 58);\n    i0.ɵɵtext(18, \"-- Seleccione --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(19, FacturacionProyectosComponent_ng_template_29_option_19_Template, 2, 2, \"option\", 59);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"div\", 60)(21, \"label\");\n    i0.ɵɵtext(22, \" Cliente \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"select\", 57);\n    i0.ɵɵlistener(\"ngModelChange\", function FacturacionProyectosComponent_ng_template_29_Template_select_ngModelChange_23_listener($event) {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r35 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r35.filterProject.nid_client = $event);\n    });\n    i0.ɵɵelementStart(24, \"option\", 58);\n    i0.ɵɵtext(25, \"-- Seleccione --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(26, FacturacionProyectosComponent_ng_template_29_option_26_Template, 2, 3, \"option\", 59);\n    i0.ɵɵelementStart(27, \"span\", 61);\n    i0.ɵɵtext(28, \"El campo Cliente es obligatorio\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(29, \"div\", 53)(30, \"label\");\n    i0.ɵɵtext(31, \" Estado \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"select\", 57);\n    i0.ɵɵlistener(\"ngModelChange\", function FacturacionProyectosComponent_ng_template_29_Template_select_ngModelChange_32_listener($event) {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r36 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r36.filterProject.nid_status = $event);\n    });\n    i0.ɵɵelementStart(33, \"option\", 58);\n    i0.ɵɵtext(34, \"-- Seleccione --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(35, FacturacionProyectosComponent_ng_template_29_option_35_Template, 2, 2, \"option\", 59);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(36, FacturacionProyectosComponent_ng_template_29_div_36_Template, 7, 0, \"div\", 62);\n    i0.ɵɵtemplate(37, FacturacionProyectosComponent_ng_template_29_div_37_Template, 7, 0, \"div\", 62);\n    i0.ɵɵtemplate(38, FacturacionProyectosComponent_ng_template_29_div_38_Template, 7, 0, \"div\", 62);\n    i0.ɵɵelementEnd()()()()()();\n  }\n\n  if (rf & 2) {\n    const _r11 = i0.ɵɵreference(12);\n\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.filterProject.scodproject);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.permisoAdministrador)(\"ngIfThen\", _r11);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.filterProject.nid_project_type);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.ProjectTypeDropDownList);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.filterProject.nid_client);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.ClientDropDownList);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.filterProject.nid_status);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.listState);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.permisoConsultar);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.permisoConsultar);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.permisoConsultar);\n  }\n}\n\nfunction FacturacionProyectosComponent_div_63_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\");\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_64_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\")(1, \"tr\")(2, \"td\", 67);\n    i0.ɵɵtext(3, \"No se encontraron resultados para la B\\u00FAsqueda\");\n    i0.ɵɵelementEnd()()();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_66_tr_1_a_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r43 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 72);\n    i0.ɵɵlistener(\"click\", function FacturacionProyectosComponent_ng_template_66_tr_1_a_14_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r43);\n      const item_r38 = i0.ɵɵnextContext().$implicit;\n      const ctx_r41 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r41.RegistrarPago(item_r38.scodproject, item_r38.snameproject, item_r38.sstatusname));\n    });\n    i0.ɵɵelement(1, \"i\", 73);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_66_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 69);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 70);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 70);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 69);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 69);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\", 69);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 69);\n    i0.ɵɵtemplate(14, FacturacionProyectosComponent_ng_template_66_tr_1_a_14_Template, 2, 0, \"a\", 71);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r38 = ctx.$implicit;\n    const ctx_r37 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.scodproject);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.snameproject);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.sclientname);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.smanagername);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.sstatusname);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r38.sregisterdate);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r37.permisoRegistrarPago);\n  }\n}\n\nfunction FacturacionProyectosComponent_ng_template_66_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tbody\");\n    i0.ɵɵtemplate(1, FacturacionProyectosComponent_ng_template_66_tr_1_Template, 15, 7, \"tr\", 68);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(2, \"br\");\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r9.projectList);\n  }\n}\n\nexport class FacturacionProyectosComponent {\n  constructor(spinner, projectService, modalService, clientService, personService, permisoService, projectTypeService, servicePerson, mastertableService, dialog) {\n    this.spinner = spinner;\n    this.projectService = projectService;\n    this.modalService = modalService;\n    this.clientService = clientService;\n    this.personService = personService;\n    this.permisoService = permisoService;\n    this.projectTypeService = projectTypeService;\n    this.servicePerson = servicePerson;\n    this.mastertableService = mastertableService;\n    this.dialog = dialog;\n    this.filterProject = new FilterProject();\n    this.currentPage = 1; // seteamos a la pagina 1\n\n    this.itemsPerPage = 10; // mostramos 5 registros por pagina\n\n    this.totalItems = 0; // Total de registro\n\n    this.BreadLevel01 = 'Gestión de Proyectos';\n    this.Title = 'Facturación de Proyectos';\n    this.titleProjectModal = 'Proyecto | Nuevo';\n    this.projectList = [];\n    this.listState = [];\n    this.scodprojectSeleccionado = \"\";\n    this.snameprojectSeleccionado = \"\";\n    this.user = new User();\n    this.sstatusnameSeleccionado = \"\";\n    this.permisoConsultar = false;\n    this.permisoRegistrarPago = false;\n    this.permisoAdministrador = false;\n    this.permisoJefeDeProyecto = false;\n    this.nidchannel = 0;\n    this.filterProject.pagination.ItemsPerPage = this.itemsPerPage;\n    this.filterProject.pagination.TotalItems = this.totalItems;\n    this.filterProject.pagination.CurrentPage = this.currentPage;\n  }\n\n  ngOnInit() {\n    this.obtenerPermisos();\n  }\n\n  projectIngresosList() {\n    let actualDate = new Date();\n    this.projectService.insupprojectingresoslist(actualDate.getFullYear(), actualDate.getMonth() + 1).subscribe(response => {\n      var data = [];\n      var header = [\"Fecha Facturación\", \"TIPO MONEDA\", \"En Soles\", \"Código\", \"Línea de Negocio\", \"Estado\", \"Cliente\", \"Descripción del servicio\", \"CODIGO PAIS\"];\n\n      for (var i = 0; i < response.length; i++) {\n        let fechaFactura = new Date(response[i].fechaFactura);\n        var item = {};\n        item[header[0]] = ('0' + fechaFactura.getDate()).slice(-2) + \"/\" + ('0' + (fechaFactura.getMonth() + 1)).slice(-2) + \"/\" + fechaFactura.getFullYear();\n        item[header[1]] = response[i].moneda;\n        item[header[2]] = response[i].enSoles;\n        item[header[3]] = response[i].scod;\n        item[header[4]] = response[i].stype;\n        item[header[5]] = response[i].sstatusname;\n        item[header[6]] = response[i].sclientname;\n        item[header[7]] = response[i].sdescription;\n        item[header[8]] = \"1\";\n        data.push(item);\n      } //Create workbook and worksheet\n\n\n      let workbook = new Workbook();\n      let worksheet = workbook.addWorksheet(\"Data Entry BI Ingresos\"); //Add Header Row\n\n      let headerRow = worksheet.addRow(header); // Cell Style : Fill and Border\n\n      headerRow.eachCell((cell, number) => {\n        cell.fill = {\n          type: 'pattern',\n          pattern: 'solid',\n          fgColor: {\n            argb: 'FFFFFF00'\n          },\n          bgColor: {\n            argb: 'FF0000FF'\n          }\n        };\n        cell.border = {\n          top: {\n            style: 'thin'\n          },\n          left: {\n            style: 'thin'\n          },\n          bottom: {\n            style: 'thin'\n          },\n          right: {\n            style: 'thin'\n          }\n        };\n      }); // Add Data and Conditional Formatting\n\n      data.forEach(element => {\n        let eachRow = [];\n        header.forEach(headers => {\n          eachRow.push(element[headers]);\n        }); // if (element.isDeleted === \"Y\") {\n        //   let deletedRow = worksheet.addRow(eachRow);\n        //   deletedRow.eachCell((cell, number) => {\n        //     cell.font = { name: 'Calibri', family: 4, size: 11, bold: false, strike: true };\n        //   })\n        // } else {\n\n        worksheet.addRow(eachRow); // }\n      });\n      worksheet.getColumn(1).width = 15;\n      worksheet.getColumn(3).width = 10;\n      worksheet.getColumn(4).width = 20;\n      worksheet.getColumn(5).width = 20;\n      worksheet.getColumn(7).width = 30;\n      worksheet.getColumn(8).width = 30;\n      worksheet.addRow([]); //Generate Excel File with given name\n\n      workbook.xlsx.writeBuffer().then(data => {\n        let blob = new Blob([data], {\n          type: \"xlsx\"\n        });\n        fs.saveAs(blob, \"Data Entry BI Datos Personal\" + \".xlsx\");\n      });\n    });\n  }\n\n  projectGastosList() {\n    let FiltrosGastos = new FilterProject();\n    FiltrosGastos.pagination.ItemsPerPage = 999;\n    FiltrosGastos.pagination.TotalItems = 0;\n    FiltrosGastos.pagination.CurrentPage = 1;\n    FiltrosGastos.nid_manager = 0;\n    FiltrosGastos.nid_status = 0;\n    this.spinner.show();\n    this.projectService.getprojectpagination(FiltrosGastos).subscribe({\n      next: res => {\n        let proyectos = res.data;\n        this.obtenerListaHoras(proyectos);\n        this.spinner.hide();\n      },\n      error: err => {\n        this.spinner.hide();\n        Swal.fire({\n          icon: 'error',\n          title: 'Ocurrió un error al Exportar los gastos' //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\n\n        });\n      }\n    });\n  }\n\n  obtenerListaHoras(proyectos) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let response = [];\n\n      for (const proyecto of proyectos) {\n        var projectStep1 = lastValueFrom(_this.projectService.getproject(proyecto.scodproject));\n        var projectStep2 = lastValueFrom(_this.projectService.getprojectdtep2(proyecto.scodproject)); // Devuelve el costo para cada integrante del proyecto  \n\n        var costoIntegrantes = lastValueFrom(_this.servicePerson.getPersonCostByScodproject(proyecto.scodproject)); // Devuelve las horas registradas para el proyecto\n\n        var horasRegistradas = lastValueFrom(_this.projectService.getprojecthourslog(proyecto.scodproject));\n\n        _this.spinner.show('SpinnerProject');\n\n        yield Promise.all([projectStep1, projectStep2, costoIntegrantes, horasRegistradas]).then(value => {\n          _this.spinner.hide('SpinnerProject');\n\n          if (value[3] === null || value[3] === undefined) {\n            return;\n          } // Step 1\n\n\n          let projectStep1 = value[0]; // Step 2\n\n          let projectStep2 = value[1]; // Costo Integrante\n\n          let listCost = value[2];\n\n          if (listCost === null || listCost === undefined) {\n            return;\n          }\n\n          listCost.forEach(element => {\n            element.dcost_date = new Date(element.dcost_date);\n          });\n          let listProjectHoursLog = value[3].filter(x => x.sstate == \"A\");\n\n          let costoReal = _this.calcularCostoReal(listProjectHoursLog, listCost);\n\n          if (costoReal <= 0) {\n            return;\n          } // let actualDate = new Date();\n          // let stringActualDate = actualDate.getFullYear() + \"-\" + (actualDate.getMonth() + 1);\n          // let ultimoDia = new Date(stringActualDate)\n          // console.log(\"El ultimo día es\", ultimoDia.getDate(), \"Del mes\" , ultimoDia);\n\n\n          let nombreCliente = _this.ClientDropDownList.find(x => x.nid_client == projectStep1.nid_client).sname + ' - ' + _this.ClientDropDownList.find(x => x.nid_client == projectStep1.nid_client).sbusinessname;\n\n          console.log(\"PROYECTO\", projectStep1);\n          let objeto = {\n            \"fecha_D\": \"12/12/21\",\n            \"tipoMoneda\": projectStep2.ncurrency,\n            \"codigo\": projectStep1.scodproject,\n            \"linea\": projectStep1.nid_project_type,\n            \"estado\": projectStep1.nid_status,\n            \"cliente\": nombreCliente,\n            \"descripcion\": projectStep1.sdescription,\n            \"gastos\": costoReal\n          };\n          response.push(objeto);\n        });\n      }\n\n      var data = [];\n      var header = [\"Fecha D.\", \"TIPO MONEDA\", \"Código\", \"Línea de Negocio\", \"Estado\", \"Cliente\", \"Descripción del servicio\", \"Gastos Incurridos\"];\n\n      for (var i = 0; i < response.length; i++) {\n        let fechaFactura = new Date(response[i].fechaFactura);\n        var item = {};\n        item[header[0]] = response[i].fecha_D;\n        item[header[1]] = response[i].tipoMoneda;\n        item[header[2]] = response[i].codigo;\n        item[header[3]] = response[i].linea;\n        item[header[4]] = response[i].estado;\n        item[header[5]] = response[i].cliente;\n        item[header[6]] = response[i].descripcion;\n        item[header[7]] = response[i].gastos;\n        data.push(item);\n      } //Create workbook and worksheet\n\n\n      let workbook = new Workbook();\n      let worksheet = workbook.addWorksheet(\"Data Entry BI GASTOS\"); //Add Header Row\n\n      let headerRow = worksheet.addRow(header); // Cell Style : Fill and Border\n\n      headerRow.eachCell((cell, number) => {\n        cell.fill = {\n          type: 'pattern',\n          pattern: 'solid',\n          fgColor: {\n            argb: 'FFFFFF00'\n          },\n          bgColor: {\n            argb: 'FF0000FF'\n          }\n        };\n        cell.border = {\n          top: {\n            style: 'thin'\n          },\n          left: {\n            style: 'thin'\n          },\n          bottom: {\n            style: 'thin'\n          },\n          right: {\n            style: 'thin'\n          }\n        };\n      }); // Add Data and Conditional Formatting\n\n      data.forEach(element => {\n        let eachRow = [];\n        header.forEach(headers => {\n          eachRow.push(element[headers]);\n        });\n        worksheet.addRow(eachRow);\n      });\n      worksheet.getColumn(1).width = 15;\n      worksheet.getColumn(3).width = 10;\n      worksheet.getColumn(4).width = 20;\n      worksheet.getColumn(5).width = 20;\n      worksheet.getColumn(7).width = 30;\n      worksheet.getColumn(8).width = 30;\n      worksheet.addRow([]); //Generate Excel File with given name\n\n      workbook.xlsx.writeBuffer().then(data => {\n        let blob = new Blob([data], {\n          type: \"xlsx\"\n        });\n        fs.saveAs(blob, \"Data Entry BI Gastos\" + \".xlsx\");\n      });\n    })();\n  }\n\n  calcularCostoReal(listProjectHoursLog, listCost) {\n    let costoReal = 0;\n    let fechaRegistro;\n    let horas;\n    let actualDate = new Date();\n\n    for (let i = 0; i < listProjectHoursLog.length; i++) {\n      fechaRegistro = new Date(listProjectHoursLog[i].dregistration_date);\n      fechaRegistro.setDate(fechaRegistro.getDate() + 1);\n\n      if (fechaRegistro.getFullYear() == actualDate.getFullYear() && fechaRegistro.getMonth() == actualDate.getMonth()) {\n        let costoRealIntegrante = this.getCostoReal(listCost, listProjectHoursLog[i].nid_person, fechaRegistro);\n        horas = listProjectHoursLog[i].nnumber_hours;\n        costoReal += Number(costoRealIntegrante) * Number(horas);\n      }\n    }\n\n    return costoReal;\n  }\n\n  getCostoReal(listCost, nid_person, fechaRegistro) {\n    // Number(this.listCost.find(x=>x.nid_person == nid_person).ncost)\n    var histCost = listCost.filter(x => x.nid_person == nid_person);\n    histCost.sort(function (a, b) {\n      return a.dcost_date.getTime() - b.dcost_date.getTime();\n    });\n    var ultima_pos = histCost.length - 1;\n\n    if (ultima_pos < 0) {\n      // show error message\n      console.log(\"No hay costos para esta persona\");\n      return 0;\n    } // La lista ordenada DESC\n\n\n    if (fechaRegistro >= histCost[ultima_pos].dcost_date) {\n      return histCost[ultima_pos].ncost;\n    } else {\n      // Validar a que rango corresponde\n      for (let i = 0; i < ultima_pos; i++) {\n        if (fechaRegistro >= histCost[i].dcost_date && fechaRegistro < histCost[i + 1].dcost_date) {\n          return histCost[i].ncost;\n        }\n      }\n    } // Si llega aca, el algoritmo esta mal xd o un personal registro hora cuando no tenia asignado costo (registra 09/10 y su primer costo registrado es 10/10)\n\n\n    console.log(\"Error algoritmo fallido\"); // He tenido problemas porque hay usuarios que tienen su costo 27-3-2023 y registran el 22-03-2023 pues no les retorna una costoReal\n    // En este caso retornaré la primera ingresada\n\n    return histCost[0].ncost;\n  }\n\n  obtenerPermisos() {\n    this.permisoService.getpermissionbyuser(10).subscribe(response => {\n      console.log(\"Permisos\", response);\n      response.forEach(element => {\n        if (element.sname == \"Consultar\") {\n          this.permisoConsultar = element.permission;\n        }\n\n        if (element.sname == \"Registrar_Pago_Tabla\") {\n          this.permisoRegistrarPago = element.permission;\n        }\n\n        if (element.sname == \"Permiso_Administrador\") {\n          this.permisoAdministrador = element.permission;\n        }\n\n        if (element.sname == \"Permiso_Jefe_Proyecto\") {\n          this.permisoJefeDeProyecto = element.permission;\n        }\n      }); // Despues de obtener permisos viene lo demas\n\n      if (sessionStorage.getItem('Guard') !== null) {\n        this.user = JSON.parse(sessionStorage.getItem('User'));\n      }\n\n      this.getClientDropDown();\n      this.getPersonDropDown();\n      this.getProjectTypeDropDown();\n      this.getState();\n      this.begin();\n    }, error => {\n      console.error(error);\n    });\n  }\n\n  FormatDate(fec, type) {\n    const hdia = fec.day.toString().padStart(2, '0');\n    const hmes = fec.month.toString().padStart(2, '0');\n    const hanio = fec.year.toString();\n    return hanio + '-' + hmes + '-' + hdia;\n  }\n\n  getState() {\n    this.spinner.show('SpinnerProject'); //let idFather=this.listCategory.find(x=>x.nid_mastertable_type==id).nid_mastertable;\n\n    this.mastertableService.getmastertable(50).subscribe(response => {\n      this.listState = response;\n      console.log(\"EstAdos:\", this.listState);\n      this.spinner.hide('SpinnerProject');\n    }, error => {\n      console.error(error);\n      this.spinner.hide('SpinnerProject');\n    });\n  }\n\n  search() {\n    // this.showFormDetails = false;\n    this.spinner.show();\n\n    if (this.permisoAdministrador) {\n      this.filterProject.nid_manager = Number(this.filterProject.nid_manager);\n    } else {\n      this.filterProject.nid_manager = this.user.nid_person;\n    }\n\n    this.filterProject.nid_project_type = Number(this.filterProject.nid_project_type);\n    this.filterProject.nid_status = +this.filterProject.nid_status;\n    this.filterProject.nid_client = Number(this.filterProject.nid_client);\n    this.projectService.getprojectpagination(this.filterProject).subscribe(res => {\n      try {\n        if (res == null) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Ocurrió un error al obtener los registros.' //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\n\n          });\n        }\n\n        this.spinner.hide();\n        this.projectList = res.data;\n        this.totalItems = res.pagination.totalItems;\n      } catch (e) {\n        this.spinner.hide();\n        this.projectList = null;\n        this.totalItems = 0;\n      }\n    });\n  }\n\n  getClientDropDown() {\n    this.spinner.show('SpinnerProject');\n    this.clientService.getDropdownlist(0).subscribe(response => {\n      if (response == null) {\n        this.filterProject.nid_client = 0;\n        return;\n      }\n\n      this.ClientDropDownList = response;\n\n      if (this.ClientDropDownList.length > 0) {\n        this.filterProject.nid_client = 0;\n      }\n\n      this.spinner.hide('SpinnerProject');\n    }, error => {\n      console.error(error);\n      this.spinner.hide('SpinnerProject');\n    });\n  }\n\n  getPersonDropDown() {\n    this.spinner.show('SpinnerProject');\n    this.personService.getDropdownlist().subscribe(response => {\n      if (response == null) {\n        this.filterProject.nid_manager = 0;\n        return;\n      }\n\n      this.PersonDropDownList = response;\n\n      if (this.PersonDropDownList.length > 0) {\n        this.filterProject.nid_manager = 0;\n      }\n\n      this.spinner.hide('SpinnerProject');\n    }, error => {\n      console.error(error);\n      this.spinner.hide('SpinnerProject');\n    });\n  }\n\n  getProjectTypeDropDown() {\n    this.spinner.show('SpinnerProject');\n    this.projectTypeService.getDropdownlist().subscribe(response => {\n      if (response == null) {\n        this.filterProject.nid_project_type = 0;\n        return;\n      }\n\n      this.ProjectTypeDropDownList = response;\n\n      if (this.ProjectTypeDropDownList.length > 0) {\n        this.filterProject.nid_project_type = 0;\n      }\n\n      this.spinner.hide('SpinnerProject');\n    }, error => {\n      console.error(error);\n      this.spinner.hide('SpinnerProject');\n    });\n  }\n\n  pageChanged(event) {\n    this.currentPage = event;\n    this.filterProject.pagination.CurrentPage = this.currentPage;\n    this.search();\n  }\n\n  thereAreProjectsLoad() {\n    if (typeof this.projectList === 'undefined') return false;\n    if (this.projectList === null) return false;\n    if (this.projectList.length === 0) return false;\n    return true;\n  }\n\n  ChangeRecordByPage() {\n    this.filterProject.pagination.ItemsPerPage = Number(this.itemsPerPage);\n    this.search();\n  }\n\n  RegistrarPago(scod, snameproject, ssname) {\n    this.sstatusnameSeleccionado = ssname;\n    this.scodprojectSeleccionado = scod;\n    this.snameprojectSeleccionado = snameproject;\n    this.titleProjectModal = 'Registrar pago';\n    const dialogFacturacion = this.dialog.open(RegistroPagosComponent, {\n      width: '1100px',\n      height: '90%',\n      autoFocus: false,\n      data: {\n        titleProjectModal: 'Registrar pago',\n        scodproject: this.scodprojectSeleccionado,\n        sstatusname: this.sstatusnameSeleccionado,\n        snameproject: this.snameprojectSeleccionado\n      },\n      disableClose: false\n    });\n    dialogFacturacion.afterClosed().subscribe(data => {\n      // if (data != null){\n      this.search(); // }\n    });\n  }\n\n  closeModal() {\n    this.modalService.dismissAll();\n  }\n\n  begin() {\n    this.spinner.show();\n    this.filterProject.nid_manager = this.user.nid_person;\n\n    if (this.permisoAdministrador) {\n      this.filterProject.nid_manager = 0;\n    }\n\n    this.filterProject.nid_status = 1;\n    this.projectService.getprojectpagination(this.filterProject).subscribe(res => {\n      try {\n        if (res == null) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Ocurrió un error al obtener los registros.' //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\n\n          });\n        }\n\n        this.spinner.hide();\n        this.projectList = res.data;\n        this.totalItems = res.pagination.totalItems;\n      } catch (e) {\n        this.spinner.hide();\n        this.projectList = null;\n        this.totalItems = 0;\n      }\n    });\n  }\n\n}\n\nFacturacionProyectosComponent.ɵfac = function FacturacionProyectosComponent_Factory(t) {\n  return new (t || FacturacionProyectosComponent)(i0.ɵɵdirectiveInject(i1.NgxSpinnerService), i0.ɵɵdirectiveInject(i2.ProjectService), i0.ɵɵdirectiveInject(i3.NgbModal), i0.ɵɵdirectiveInject(i4.ClientService), i0.ɵɵdirectiveInject(i5.PersonService), i0.ɵɵdirectiveInject(i6.PermisoService), i0.ɵɵdirectiveInject(i7.ProjectTypeService), i0.ɵɵdirectiveInject(i5.PersonService), i0.ɵɵdirectiveInject(i8.MastertableService), i0.ɵɵdirectiveInject(i9.MatDialog));\n};\n\nFacturacionProyectosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: FacturacionProyectosComponent,\n  selectors: [[\"app-facturacion-proyectos\"]],\n  decls: 90,\n  vars: 14,\n  consts: [[1, \"app-content\", \"content\", \"bg-white\"], [1, \"content-wrapper\"], [1, \"content-header\", \"row\"], [1, \"content-header-left\", \"col-md-6\", \"col-12\"], [1, \"content-header-title\"], [1, \"row\", \"breadcrumbs-top\"], [1, \"breadcrumb-wrapper\", \"col-12\"], [1, \"breadcrumb\"], [1, \"breadcrumb-item\"], [\"routerLink\", \"/manage/inicio\"], [\"routerLink\", \"/manage/facturacion-proyectos\"], [1, \"breadcrumb-item\", \"active\"], [1, \"content-body\"], [1, \"row\"], [1, \"col-lg-12\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"heading-elements-toggle\"], [1, \"la\", \"la-ellipsis-v\", \"font-medium-3\"], [4, \"ngIf\", \"ngIfThen\", \"ngIfElse\"], [\"NoFiltro\", \"\"], [\"MostrarFiltro\", \"\"], [\"id\", \"configuration\"], [1, \"col-12\"], [1, \"card-content\", \"collapse\", \"show\"], [1, \"card-body\", \"card-dashboard\"], [1, \"form-group\", 2, \"overflow-x\", \"scroll\"], [1, \"col-md-12\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\", \"table-bordered\", 2, \"table-layout\", \"fixed\"], [\"scope\", \"col\", 2, \"text-align\", \"center\", \"width\", \"110px\"], [\"scope\", \"col\", 2, \"text-align\", \"center\", \"width\", \"250px\"], [\"scope\", \"col\", 2, \"text-align\", \"center\", \"width\", \"300px\"], [\"scope\", \"col\", 2, \"text-align\", \"center\", \"width\", \"200px\"], [\"scope\", \"col\", 2, \"text-align\", \"center\", \"width\", \"80px\"], [\"NoexistenRegistro\", \"\"], [\"MostrarRegistro\", \"\"], [1, \"col-md-1\"], [1, \"select2\", \"form-control\", \"input-sm\", 3, \"ngModel\", \"change\", \"ngModelChange\"], [\"value\", \"5\"], [\"value\", \"10\"], [\"value\", \"15\"], [\"value\", \"20\"], [1, \"col-md-10\"], [1, \"d-flex\", \"justify-content-end\"], [3, \"collectionSize\", \"pageSize\", \"page\", \"rotate\", \"pageChange\"], [\"id\", \"ifrmTemplate\", \"name\", \"ifrmTemplate\", 2, \"display\", \"none\"], [\"id\", \"afile\", \"name\", \"afile\", 2, \"display\", \"none\"], [\"SIZE\", \"10\", 2, \"color\", \"white\"], [2, \"padding-left\", \"30px\"], [1, \"card-body\"], [1, \"form-body\"], [1, \"form-group\", \"col-md-2\", \"col-sm-12\"], [\"type\", \"text\", \"name\", \"\", \"id\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [4, \"ngIf\", \"ngIfThen\"], [\"MostrarResponsable\", \"\"], [\"required\", \"\", 1, \"select2\", \"form-control\", \"block\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"0\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"form-group\", \"col-md-4\", \"col-sm-12\"], [1, \"mensaje-error-control\"], [\"class\", \"form-group col-md-2 col-sm-12\", 4, \"ngIf\"], [3, \"value\"], [1, \"form-actions\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-info\", \"btn-active\", 3, \"click\"], [1, \"la\", \"la-search\"], [\"colspan\", \"8\", 2, \"text-align\", \"center\"], [4, \"ngFor\", \"ngForOf\"], [1, \"width-6\", 2, \"text-align\", \"center\"], [1, \"width-6\", 2, \"text-align\", \"left\"], [\"title\", \"Registrar pago\", 3, \"click\", 4, \"ngIf\"], [\"title\", \"Registrar pago\", 3, \"click\"], [1, \"la\", \"la-money\"]],\n  template: function FacturacionProyectosComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h3\", 4);\n      i0.ɵɵtext(5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"div\", 5)(7, \"div\", 6)(8, \"ol\", 7)(9, \"li\", 8)(10, \"a\", 9);\n      i0.ɵɵtext(11, \"Inicio\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(12, \"li\", 8)(13, \"a\", 10);\n      i0.ɵɵtext(14);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(15, \"li\", 11);\n      i0.ɵɵtext(16);\n      i0.ɵɵelementEnd()()()()()();\n      i0.ɵɵelementStart(17, \"div\", 12)(18, \"div\", 13)(19, \"div\", 14)(20, \"div\", 15)(21, \"div\", 16)(22, \"h4\", 17);\n      i0.ɵɵtext(23, \" FILTROS \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(24, \"a\", 18);\n      i0.ɵɵelement(25, \"i\", 19);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(26, FacturacionProyectosComponent_div_26_Template, 1, 0, \"div\", 20);\n      i0.ɵɵtemplate(27, FacturacionProyectosComponent_ng_template_27_Template, 2, 0, \"ng-template\", null, 21, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵtemplate(29, FacturacionProyectosComponent_ng_template_29_Template, 39, 12, \"ng-template\", null, 22, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(31, \"section\", 23)(32, \"div\", 13)(33, \"div\", 24)(34, \"div\", 15)(35, \"div\", 16)(36, \"h4\", 17);\n      i0.ɵɵtext(37, \"Lista de Resultado\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(38, \"a\", 18);\n      i0.ɵɵelement(39, \"i\", 19);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(40, \"div\", 25)(41, \"div\", 26)(42, \"div\", 13)(43, \"div\", 27)(44, \"div\", 28)(45, \"div\", 29)(46, \"table\", 30)(47, \"thead\")(48, \"tr\")(49, \"th\", 31);\n      i0.ɵɵtext(50, \"C\\u00F3d. Servicio\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(51, \"th\", 32);\n      i0.ɵɵtext(52, \"Nombre Servicio\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(53, \"th\", 33);\n      i0.ɵɵtext(54, \"Cliente\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(55, \"th\", 34);\n      i0.ɵɵtext(56, \"Responsable\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(57, \"th\", 31);\n      i0.ɵɵtext(58, \"Estado\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(59, \"th\", 31);\n      i0.ɵɵtext(60, \"F. Registro\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(61, \"th\", 35);\n      i0.ɵɵtext(62, \"Acciones\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(63, FacturacionProyectosComponent_div_63_Template, 1, 0, \"div\", 20);\n      i0.ɵɵtemplate(64, FacturacionProyectosComponent_ng_template_64_Template, 4, 0, \"ng-template\", null, 36, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵtemplate(66, FacturacionProyectosComponent_ng_template_66_Template, 3, 1, \"ng-template\", null, 37, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(68, \"div\", 28)(69, \"div\", 13)(70, \"label\", 38);\n      i0.ɵɵtext(71, \"Registros por P\\u00E1gina\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(72, \"div\", 38)(73, \"select\", 39);\n      i0.ɵɵlistener(\"change\", function FacturacionProyectosComponent_Template_select_change_73_listener() {\n        return ctx.ChangeRecordByPage();\n      })(\"ngModelChange\", function FacturacionProyectosComponent_Template_select_ngModelChange_73_listener($event) {\n        return ctx.itemsPerPage = $event;\n      });\n      i0.ɵɵelementStart(74, \"option\", 40);\n      i0.ɵɵtext(75, \"5\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(76, \"option\", 41);\n      i0.ɵɵtext(77, \"10\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(78, \"option\", 42);\n      i0.ɵɵtext(79, \"15\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(80, \"option\", 43);\n      i0.ɵɵtext(81, \"20\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(82, \"div\", 44)(83, \"div\", 45)(84, \"ngb-pagination\", 46);\n      i0.ɵɵlistener(\"pageChange\", function FacturacionProyectosComponent_Template_ngb_pagination_pageChange_84_listener($event) {\n        return ctx.currentPage = $event;\n      })(\"pageChange\", function FacturacionProyectosComponent_Template_ngb_pagination_pageChange_84_listener($event) {\n        return ctx.pageChanged($event);\n      });\n      i0.ɵɵelementEnd()()()()()()()()()()()()()()()();\n      i0.ɵɵelement(85, \"iframe\", 47)(86, \"a\", 48);\n      i0.ɵɵelementStart(87, \"ngx-spinner\")(88, \"h1\", 49);\n      i0.ɵɵtext(89, \"Cargando ...\");\n      i0.ɵɵelementEnd()();\n    }\n\n    if (rf & 2) {\n      const _r1 = i0.ɵɵreference(28);\n\n      const _r3 = i0.ɵɵreference(30);\n\n      const _r6 = i0.ɵɵreference(65);\n\n      const _r8 = i0.ɵɵreference(67);\n\n      i0.ɵɵadvance(5);\n      i0.ɵɵtextInterpolate(ctx.Title);\n      i0.ɵɵadvance(9);\n      i0.ɵɵtextInterpolate(ctx.BreadLevel01);\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\"\", ctx.Title, \" \");\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"ngIf\", !ctx.permisoAdministrador && !ctx.permisoJefeDeProyecto)(\"ngIfThen\", _r1)(\"ngIfElse\", _r3);\n      i0.ɵɵadvance(37);\n      i0.ɵɵproperty(\"ngIf\", !ctx.thereAreProjectsLoad())(\"ngIfThen\", _r6)(\"ngIfElse\", _r8);\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"ngModel\", ctx.itemsPerPage);\n      i0.ɵɵadvance(11);\n      i0.ɵɵproperty(\"collectionSize\", ctx.totalItems)(\"pageSize\", ctx.itemsPerPage)(\"page\", ctx.currentPage)(\"rotate\", true);\n    }\n  },\n  dependencies: [i10.RouterLinkWithHref, i11.NgForOf, i11.NgIf, i12.NgSelectOption, i12.ɵNgSelectMultipleOption, i12.DefaultValueAccessor, i12.SelectControlValueAccessor, i12.NgControlStatus, i12.RequiredValidator, i12.NgModel, i3.NgbPagination, i1.NgxSpinnerComponent],\n  styles: [\".xlModal[_ngcontent-%COMP%]    > .modal-dialog[_ngcontent-%COMP%] {\\r\\n    max-width: 1490px !important;\\r\\n    min-width: 971px !important;   \\r\\n    width: 95% !important;\\r\\n}\\r\\n  .my-class .modal-dialog { \\r\\n    max-width: 80%;\\r\\n    width: 80%;\\r\\n}\\r\\n  .modal-lg{\\r\\n    max-width: 1500px!important;\\r\\n}\\r\\n.width-6[_ngcontent-%COMP%]{\\r\\n    width:16.66666666666667%;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZhY3R1cmFjaW9uLXByb3llY3Rvcy5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBQ0ksNEJBQTRCO0lBQzVCLDJCQUEyQjtJQUMzQixxQkFBcUI7QUFDekI7QUFDQTtJQUNJLGNBQWM7SUFDZCxVQUFVO0FBQ2Q7QUFDQTtJQUNJLDJCQUEyQjtBQUMvQjtBQUNBO0lBQ0ksd0JBQXdCO0FBQzVCIiwiZmlsZSI6ImZhY3R1cmFjaW9uLXByb3llY3Rvcy5jb21wb25lbnQuY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLnhsTW9kYWwgPiAubW9kYWwtZGlhbG9nIHtcclxuICAgIG1heC13aWR0aDogMTQ5MHB4ICFpbXBvcnRhbnQ7XHJcbiAgICBtaW4td2lkdGg6IDk3MXB4ICFpbXBvcnRhbnQ7ICAgXHJcbiAgICB3aWR0aDogOTUlICFpbXBvcnRhbnQ7XHJcbn1cclxuOjpuZy1kZWVwIC5teS1jbGFzcyAubW9kYWwtZGlhbG9nIHsgXHJcbiAgICBtYXgtd2lkdGg6IDgwJTtcclxuICAgIHdpZHRoOiA4MCU7XHJcbn1cclxuOjpuZy1kZWVwIC5tb2RhbC1sZ3tcclxuICAgIG1heC13aWR0aDogMTUwMHB4IWltcG9ydGFudDtcclxufVxyXG4ud2lkdGgtNntcclxuICAgIHdpZHRoOjE2LjY2NjY2NjY2NjY2NjY3JTtcclxufVxyXG5cclxuIl19 */\"]\n});","map":{"version":3,"mappings":"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","names":["FilterProject","Swal","User","RegistroPagosComponent","Workbook","fs","lastValueFrom","i0","_r11","FacturacionProyectosComponent","constructor","spinner","projectService","modalService","clientService","personService","permisoService","projectTypeService","servicePerson","mastertableService","dialog","filterProject","pagination","ItemsPerPage","itemsPerPage","TotalItems","totalItems","CurrentPage","currentPage","ngOnInit","obtenerPermisos","projectIngresosList","actualDate","Date","insupprojectingresoslist","getFullYear","getMonth","subscribe","response","data","header","i","length","fechaFactura","item","getDate","slice","moneda","enSoles","scod","stype","sstatusname","sclientname","sdescription","push","workbook","worksheet","addWorksheet","headerRow","addRow","eachCell","cell","number","fill","type","pattern","fgColor","argb","bgColor","border","top","style","left","bottom","right","forEach","element","eachRow","headers","getColumn","width","xlsx","writeBuffer","then","blob","Blob","saveAs","projectGastosList","FiltrosGastos","nid_manager","nid_status","show","getprojectpagination","next","res","proyectos","obtenerListaHoras","hide","error","err","fire","icon","title","proyecto","projectStep1","getproject","scodproject","projectStep2","getprojectdtep2","costoIntegrantes","getPersonCostByScodproject","horasRegistradas","getprojecthourslog","Promise","all","value","undefined","listCost","dcost_date","listProjectHoursLog","filter","x","sstate","costoReal","calcularCostoReal","nombreCliente","ClientDropDownList","find","nid_client","sname","sbusinessname","console","log","objeto","ncurrency","nid_project_type","fecha_D","tipoMoneda","codigo","linea","estado","cliente","descripcion","gastos","fechaRegistro","horas","dregistration_date","setDate","costoRealIntegrante","getCostoReal","nid_person","nnumber_hours","Number","histCost","sort","a","b","getTime","ultima_pos","ncost","getpermissionbyuser","permisoConsultar","permission","permisoRegistrarPago","permisoAdministrador","permisoJefeDeProyecto","sessionStorage","getItem","user","JSON","parse","getClientDropDown","getPersonDropDown","getProjectTypeDropDown","getState","begin","FormatDate","fec","hdia","day","toString","padStart","hmes","month","hanio","year","getmastertable","listState","search","projectList","e","getDropdownlist","PersonDropDownList","ProjectTypeDropDownList","pageChanged","event","thereAreProjectsLoad","ChangeRecordByPage","RegistrarPago","snameproject","ssname","sstatusnameSeleccionado","scodprojectSeleccionado","snameprojectSeleccionado","titleProjectModal","dialogFacturacion","open","height","autoFocus","disableClose","afterClosed","closeModal","dismissAll","selectors","decls","vars","consts","template","ctx","_r1","_r3","_r6","_r8"],"sourceRoot":"","sources":["C:\\Users\\Usuario\\Documents\\Work\\sgp\\GestionDeProyectos.2023.DEV\\MigracionAngular14\\src\\app\\layout\\manage\\components\\facturacion-proyectos\\facturacion-proyectos.component.ts","C:\\Users\\Usuario\\Documents\\Work\\sgp\\GestionDeProyectos.2023.DEV\\MigracionAngular14\\src\\app\\layout\\manage\\components\\facturacion-proyectos\\facturacion-proyectos.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { DropDownList } from '../../model/dropdownlist/DropDownList';\r\nimport { FilterProject } from '../../model/project/filterproject';\r\nimport { ClientService } from '../../services/client/client.service';\r\nimport { PersonService } from '../../services/person/person.service';\r\nimport { ProjectService } from '../../services/project/project.service';\r\nimport { ProjectTypeService } from '../../services/project/projecttype.service';\r\nimport { NgbModal } from '@ng-bootstrap/ng-bootstrap';\r\nimport { NgxSpinnerService } from 'ngx-spinner';\r\nimport Swal from 'sweetalert2';\r\nimport { User } from 'src/app/layout/manage/model/user/user';\r\nimport { PermisoService } from '../../services/common/permiso.service';\r\nimport { MastertableService } from '../../services/common/mastertable.service';\r\nimport { MasterTable } from '../../model/common/mastertable';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { RegistroPagosComponent } from '../registro-pagos/registro-pagos.component';\r\n\r\nimport { Workbook } from 'exceljs'; import * as fs from 'file-saver';\r\nimport { lastValueFrom } from 'rxjs';\r\nimport { Client } from '../../model/client/client';\r\n\r\n@Component({\r\n  selector: 'app-facturacion-proyectos',\r\n  templateUrl: './facturacion-proyectos.component.html',\r\n  styleUrls: ['./facturacion-proyectos.component.css']\r\n})\r\nexport class FacturacionProyectosComponent implements OnInit {\r\n\r\n  filterProject: FilterProject = new FilterProject();\r\n  currentPage: number = 1; // seteamos a la pagina 1\r\n  itemsPerPage: number = 10; // mostramos 5 registros por pagina\r\n  totalItems: number = 0; // Total de registro\r\n  public BreadLevel01 = 'Gestión de Proyectos';\r\n  public Title = 'Facturación de Proyectos';\r\n  public titleProjectModal = 'Proyecto | Nuevo'\r\n  projectList: any[] = [];\r\n  ClientDropDownList: Client[];\r\n  PersonDropDownList: DropDownList[];\r\n  ProjectTypeDropDownList: DropDownList[];\r\n  listState: MasterTable[] = [];\r\n  scodprojectSeleccionado: string = \"\";\r\n  snameprojectSeleccionado: string = \"\";\r\n  user: User = new User();\r\n\r\n  sstatusnameSeleccionado: string = \"\";\r\n\r\n  permisoConsultar: boolean = false;\r\n  permisoRegistrarPago: boolean = false;\r\n  permisoAdministrador: boolean = false;\r\n  permisoJefeDeProyecto: boolean = false;\r\n\r\n  constructor(\r\n\r\n    private spinner: NgxSpinnerService,\r\n    private projectService: ProjectService,\r\n    private modalService: NgbModal,\r\n    private clientService: ClientService,\r\n    private personService: PersonService,\r\n    private permisoService: PermisoService,\r\n    private projectTypeService: ProjectTypeService,\r\n    private servicePerson: PersonService,\r\n    private mastertableService: MastertableService,\r\n    private dialog: MatDialog\r\n  ) {\r\n    this.filterProject.pagination.ItemsPerPage = this.itemsPerPage;\r\n    this.filterProject.pagination.TotalItems = this.totalItems;\r\n    this.filterProject.pagination.CurrentPage = this.currentPage;\r\n  }\r\n  nidchannel = 0;\r\n  startDateFilter: any;\r\n  endDateFilter: any;\r\n  ngOnInit() {\r\n    this.obtenerPermisos();\r\n  }\r\n\r\n  projectIngresosList() {\r\n    let actualDate = new Date();\r\n\r\n\r\n    this.projectService.insupprojectingresoslist(actualDate.getFullYear(), actualDate.getMonth() + 1).subscribe(response => {\r\n\r\n      var data = [];\r\n      var header = [\"Fecha Facturación\", \"TIPO MONEDA\", \"En Soles\", \"Código\", \"Línea de Negocio\", \"Estado\", \"Cliente\", \"Descripción del servicio\", \"CODIGO PAIS\"];\r\n\r\n\r\n      for (var i = 0; i < response.length; i++) {\r\n        let fechaFactura = new Date(response[i].fechaFactura)\r\n\r\n        var item = {};\r\n        item[header[0]] = ('0' + fechaFactura.getDate()).slice(-2) + \"/\" + ('0' + (fechaFactura.getMonth() + 1)).slice(-2) + \"/\" + fechaFactura.getFullYear();\r\n        item[header[1]] = response[i].moneda;\r\n        item[header[2]] = response[i].enSoles;\r\n        item[header[3]] = response[i].scod;\r\n        item[header[4]] = response[i].stype;\r\n        item[header[5]] = response[i].sstatusname;\r\n        item[header[6]] = response[i].sclientname;\r\n        item[header[7]] = response[i].sdescription;\r\n        item[header[8]] = \"1\";\r\n\r\n        data.push(item);\r\n\r\n      }\r\n\r\n      //Create workbook and worksheet\r\n      let workbook = new Workbook();\r\n      let worksheet = workbook.addWorksheet(\"Data Entry BI Ingresos\");\r\n      //Add Header Row\r\n      let headerRow = worksheet.addRow(header);\r\n      // Cell Style : Fill and Border\r\n      headerRow.eachCell((cell, number) => {\r\n        cell.fill = {\r\n          type: 'pattern',\r\n          pattern: 'solid',\r\n          fgColor: { argb: 'FFFFFF00' },\r\n          bgColor: { argb: 'FF0000FF' }\r\n        }\r\n        cell.border = { top: { style: 'thin' }, left: { style: 'thin' }, bottom: { style: 'thin' }, right: { style: 'thin' } }\r\n      })\r\n\r\n      // Add Data and Conditional Formatting\r\n      data.forEach((element) => {\r\n        let eachRow = [];\r\n        header.forEach((headers) => {\r\n          eachRow.push(element[headers])\r\n        })\r\n        // if (element.isDeleted === \"Y\") {\r\n        //   let deletedRow = worksheet.addRow(eachRow);\r\n        //   deletedRow.eachCell((cell, number) => {\r\n        //     cell.font = { name: 'Calibri', family: 4, size: 11, bold: false, strike: true };\r\n        //   })\r\n        // } else {\r\n        worksheet.addRow(eachRow);\r\n        // }\r\n      })\r\n\r\n      worksheet.getColumn(1).width = 15;\r\n      worksheet.getColumn(3).width = 10;\r\n      worksheet.getColumn(4).width = 20;\r\n      worksheet.getColumn(5).width = 20;\r\n      worksheet.getColumn(7).width = 30;\r\n      worksheet.getColumn(8).width = 30;\r\n      worksheet.addRow([]);\r\n      //Generate Excel File with given name\r\n      workbook.xlsx.writeBuffer().then((data) => {\r\n        let blob = new Blob([data], { type: \"xlsx\" });\r\n        fs.saveAs(blob, \"Data Entry BI Datos Personal\" + \".xlsx\");\r\n      })\r\n\r\n    })\r\n  }\r\n\r\n  projectGastosList() {\r\n    let FiltrosGastos: FilterProject = new FilterProject();\r\n    FiltrosGastos.pagination.ItemsPerPage = 999;\r\n    FiltrosGastos.pagination.TotalItems = 0;\r\n    FiltrosGastos.pagination.CurrentPage = 1;\r\n\r\n    FiltrosGastos.nid_manager = 0;\r\n    FiltrosGastos.nid_status = 0;\r\n\r\n    this.spinner.show();\r\n    this.projectService.getprojectpagination(FiltrosGastos).subscribe({\r\n      next: (res: any) => {\r\n        let proyectos = res.data;\r\n        this.obtenerListaHoras(proyectos);\r\n        this.spinner.hide();\r\n      },\r\n      error: (err) => {\r\n        this.spinner.hide();\r\n        Swal.fire({\r\n          icon: 'error',\r\n          title: 'Ocurrió un error al Exportar los gastos',\r\n          //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\r\n        });\r\n      }\r\n    }\r\n    );\r\n  }\r\n\r\n  async obtenerListaHoras(proyectos: any[]) {\r\n\r\n    let response: any[] = [];\r\n\r\n    for (const proyecto of proyectos) {\r\n\r\n      var projectStep1 = lastValueFrom(this.projectService.getproject(proyecto.scodproject));\r\n      var projectStep2 = lastValueFrom(this.projectService.getprojectdtep2(proyecto.scodproject));\r\n\r\n      // Devuelve el costo para cada integrante del proyecto  \r\n      var costoIntegrantes = lastValueFrom(this.servicePerson.getPersonCostByScodproject(proyecto.scodproject));\r\n\r\n      // Devuelve las horas registradas para el proyecto\r\n      var horasRegistradas = lastValueFrom(this.projectService.getprojecthourslog(proyecto.scodproject));\r\n\r\n      this.spinner.show('SpinnerProject');\r\n      await Promise.all([projectStep1, projectStep2, costoIntegrantes, horasRegistradas]).then((value: any) => {\r\n        this.spinner.hide('SpinnerProject');\r\n\r\n        if (value[3] === null || value[3] === undefined) {\r\n          return;\r\n        }\r\n\r\n        // Step 1\r\n        let projectStep1 = value[0]\r\n\r\n\r\n        // Step 2\r\n        let projectStep2 = value[1];\r\n\r\n        // Costo Integrante\r\n        let listCost = value[2];\r\n        if (listCost === null || listCost === undefined) {\r\n          return;\r\n        }\r\n\r\n        listCost.forEach(element => {\r\n          element.dcost_date = new Date(element.dcost_date);\r\n        });\r\n\r\n        let listProjectHoursLog = value[3].filter(x => x.sstate == \"A\");\r\n\r\n        let costoReal = this.calcularCostoReal(listProjectHoursLog, listCost);\r\n\r\n        if (costoReal <= 0) {\r\n          return;\r\n        }\r\n\r\n        // let actualDate = new Date();\r\n        // let stringActualDate = actualDate.getFullYear() + \"-\" + (actualDate.getMonth() + 1);\r\n        // let ultimoDia = new Date(stringActualDate)\r\n        // console.log(\"El ultimo día es\", ultimoDia.getDate(), \"Del mes\" , ultimoDia);\r\n\r\n        let nombreCliente = this.ClientDropDownList.find(x => x.nid_client == projectStep1.nid_client).sname\r\n                            + ' - ' + this.ClientDropDownList.find(x => x.nid_client == projectStep1.nid_client).sbusinessname;\r\n\r\n        console.log(\"PROYECTO\", projectStep1)\r\n        let objeto = {\r\n          \"fecha_D\": \"12/12/21\",\r\n          \"tipoMoneda\": projectStep2.ncurrency,\r\n          \"codigo\": projectStep1.scodproject,\r\n          \"linea\": projectStep1.nid_project_type,\r\n          \"estado\": projectStep1.nid_status,\r\n          \"cliente\": nombreCliente,\r\n          \"descripcion\": projectStep1.sdescription,\r\n          \"gastos\": costoReal\r\n        }\r\n\r\n        response.push(objeto);\r\n\r\n\r\n      })\r\n    }\r\n\r\n\r\n    var data = [];\r\n    var header = [\"Fecha D.\", \"TIPO MONEDA\", \"Código\", \"Línea de Negocio\", \"Estado\", \"Cliente\", \"Descripción del servicio\", \"Gastos Incurridos\"];\r\n\r\n\r\n    for (var i = 0; i < response.length; i++) {\r\n      let fechaFactura = new Date(response[i].fechaFactura)\r\n\r\n      var item = {};\r\n      item[header[0]] = response[i].fecha_D;\r\n      item[header[1]] = response[i].tipoMoneda;\r\n      item[header[2]] = response[i].codigo;\r\n      item[header[3]] = response[i].linea;\r\n      item[header[4]] = response[i].estado;\r\n      item[header[5]] = response[i].cliente;\r\n      item[header[6]] = response[i].descripcion;\r\n      item[header[7]] = response[i].gastos;\r\n\r\n      data.push(item);\r\n\r\n    }\r\n\r\n    //Create workbook and worksheet\r\n    let workbook = new Workbook();\r\n    let worksheet = workbook.addWorksheet(\"Data Entry BI GASTOS\");\r\n    //Add Header Row\r\n    let headerRow = worksheet.addRow(header);\r\n    // Cell Style : Fill and Border\r\n    headerRow.eachCell((cell, number) => {\r\n      cell.fill = {\r\n        type: 'pattern',\r\n        pattern: 'solid',\r\n        fgColor: { argb: 'FFFFFF00' },\r\n        bgColor: { argb: 'FF0000FF' }\r\n      }\r\n      cell.border = { top: { style: 'thin' }, left: { style: 'thin' }, bottom: { style: 'thin' }, right: { style: 'thin' } }\r\n    })\r\n\r\n    // Add Data and Conditional Formatting\r\n    data.forEach((element) => {\r\n      let eachRow = [];\r\n      header.forEach((headers) => {\r\n        eachRow.push(element[headers])\r\n      })\r\n\r\n      worksheet.addRow(eachRow);\r\n    })\r\n\r\n    worksheet.getColumn(1).width = 15;\r\n    worksheet.getColumn(3).width = 10;\r\n    worksheet.getColumn(4).width = 20;\r\n    worksheet.getColumn(5).width = 20;\r\n    worksheet.getColumn(7).width = 30;\r\n    worksheet.getColumn(8).width = 30;\r\n    worksheet.addRow([]);\r\n    //Generate Excel File with given name\r\n    workbook.xlsx.writeBuffer().then((data) => {\r\n      let blob = new Blob([data], { type: \"xlsx\" });\r\n      fs.saveAs(blob, \"Data Entry BI Gastos\" + \".xlsx\");\r\n    })\r\n\r\n\r\n  }\r\n\r\n  calcularCostoReal(listProjectHoursLog: any[], listCost) {\r\n    let costoReal = 0;\r\n    let fechaRegistro;\r\n    let horas;\r\n    let actualDate = new Date();\r\n\r\n    for (let i = 0; i < listProjectHoursLog.length; i++) {\r\n      fechaRegistro = new Date(listProjectHoursLog[i].dregistration_date);\r\n      fechaRegistro.setDate(fechaRegistro.getDate() + 1);\r\n\r\n      if (fechaRegistro.getFullYear() == actualDate.getFullYear() && fechaRegistro.getMonth() == actualDate.getMonth()) {\r\n        let costoRealIntegrante = this.getCostoReal(listCost, listProjectHoursLog[i].nid_person, fechaRegistro);\r\n        horas = listProjectHoursLog[i].nnumber_hours;\r\n        costoReal += (Number(costoRealIntegrante) * Number(horas));\r\n      }\r\n\r\n    }\r\n    return costoReal;\r\n  }\r\n\r\n  getCostoReal(listCost, nid_person, fechaRegistro) {\r\n    // Number(this.listCost.find(x=>x.nid_person == nid_person).ncost)\r\n    var histCost = listCost.filter(x => x.nid_person == nid_person);\r\n    histCost.sort(function (a, b): any {\r\n      return a.dcost_date.getTime() - b.dcost_date.getTime();\r\n    });\r\n\r\n    var ultima_pos = histCost.length - 1;\r\n    if (ultima_pos < 0) {\r\n      // show error message\r\n      console.log(\"No hay costos para esta persona\");\r\n      return 0;\r\n    }\r\n    // La lista ordenada DESC\r\n    if (fechaRegistro >= histCost[ultima_pos].dcost_date) {\r\n      return histCost[ultima_pos].ncost;\r\n    } else {\r\n      // Validar a que rango corresponde\r\n      for (let i = 0; i < ultima_pos; i++) {\r\n        if (fechaRegistro >= histCost[i].dcost_date && fechaRegistro < histCost[i + 1].dcost_date) {\r\n          return histCost[i].ncost;\r\n        }\r\n      }\r\n    }\r\n    // Si llega aca, el algoritmo esta mal xd o un personal registro hora cuando no tenia asignado costo (registra 09/10 y su primer costo registrado es 10/10)\r\n    console.log(\"Error algoritmo fallido\");\r\n    // He tenido problemas porque hay usuarios que tienen su costo 27-3-2023 y registran el 22-03-2023 pues no les retorna una costoReal\r\n    // En este caso retornaré la primera ingresada\r\n    return histCost[0].ncost;\r\n  }\r\n\r\n  obtenerPermisos() {\r\n    this.permisoService.getpermissionbyuser(10).subscribe((response: any) => {\r\n      console.log(\"Permisos\", response);\r\n      response.forEach(element => {\r\n        if (element.sname == \"Consultar\") {\r\n          this.permisoConsultar = element.permission\r\n        }\r\n        if (element.sname == \"Registrar_Pago_Tabla\") {\r\n          this.permisoRegistrarPago = element.permission\r\n        }\r\n        if (element.sname == \"Permiso_Administrador\") {\r\n          this.permisoAdministrador = element.permission\r\n        }\r\n        if (element.sname == \"Permiso_Jefe_Proyecto\") {\r\n          this.permisoJefeDeProyecto = element.permission\r\n        }\r\n\r\n      });\r\n\r\n      // Despues de obtener permisos viene lo demas\r\n      if (sessionStorage.getItem('Guard') !== null) {\r\n        this.user = JSON.parse(sessionStorage.getItem('User'));\r\n      }\r\n      this.getClientDropDown();\r\n      this.getPersonDropDown();\r\n      this.getProjectTypeDropDown();\r\n      this.getState();\r\n      this.begin();\r\n    }, (error) => {\r\n      console.error(error);\r\n    });\r\n  }\r\n  FormatDate(fec: any, type: string): string {\r\n    const hdia = fec.day.toString().padStart(2, '0');\r\n    const hmes = fec.month.toString().padStart(2, '0');\r\n    const hanio = fec.year.toString();\r\n    return hanio + '-' + hmes + '-' + hdia;\r\n  }\r\n\r\n\r\n  getState() {\r\n    this.spinner.show('SpinnerProject');\r\n    //let idFather=this.listCategory.find(x=>x.nid_mastertable_type==id).nid_mastertable;\r\n    this.mastertableService.getmastertable(50).subscribe((response: any) => {\r\n      this.listState = response;\r\n      console.log(\"EstAdos:\", this.listState);\r\n      this.spinner.hide('SpinnerProject');\r\n\r\n    }, (error) => {\r\n      console.error(error);\r\n      this.spinner.hide('SpinnerProject');\r\n    });\r\n  }\r\n\r\n  search() {\r\n    // this.showFormDetails = false;\r\n\r\n    this.spinner.show();\r\n    if (this.permisoAdministrador) {\r\n      this.filterProject.nid_manager = Number(this.filterProject.nid_manager);\r\n    } else {\r\n      this.filterProject.nid_manager = this.user.nid_person;\r\n    }\r\n    this.filterProject.nid_project_type = Number(this.filterProject.nid_project_type);\r\n    this.filterProject.nid_status = +this.filterProject.nid_status;\r\n    this.filterProject.nid_client = Number(this.filterProject.nid_client);\r\n    this.projectService.getprojectpagination(this.filterProject).subscribe(\r\n      (res: any) => {\r\n        try {\r\n\r\n          if (res == null) {\r\n\r\n            Swal.fire({\r\n              icon: 'error',\r\n              title: 'Ocurrió un error al obtener los registros.',\r\n              //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\r\n            });\r\n          }\r\n          this.spinner.hide();\r\n\r\n          this.projectList = res.data;\r\n\r\n\r\n          this.totalItems = res.pagination.totalItems;\r\n        } catch (e) {\r\n          this.spinner.hide();\r\n          this.projectList = null;\r\n          this.totalItems = 0;\r\n        }\r\n      }\r\n    );\r\n\r\n  }\r\n  getClientDropDown() {\r\n\r\n    this.spinner.show('SpinnerProject');\r\n    this.clientService.getDropdownlist(0).subscribe((response: any) => {\r\n      if (response == null) {\r\n        this.filterProject.nid_client = 0;\r\n        return;\r\n      }\r\n      this.ClientDropDownList = response;\r\n      if (this.ClientDropDownList.length > 0) {\r\n        this.filterProject.nid_client = 0;\r\n      }\r\n      this.spinner.hide('SpinnerProject');\r\n    }, (error) => {\r\n      console.error(error);\r\n      this.spinner.hide('SpinnerProject');\r\n    });\r\n  }\r\n  getPersonDropDown() {\r\n\r\n    this.spinner.show('SpinnerProject');\r\n    this.personService.getDropdownlist().subscribe((response: any) => {\r\n\r\n      if (response == null) {\r\n        this.filterProject.nid_manager = 0;\r\n        return;\r\n      }\r\n      this.PersonDropDownList = response;\r\n      if (this.PersonDropDownList.length > 0) {\r\n        this.filterProject.nid_manager = 0;\r\n      }\r\n      this.spinner.hide('SpinnerProject');\r\n    }, (error) => {\r\n      console.error(error);\r\n      this.spinner.hide('SpinnerProject');\r\n    });\r\n  }\r\n  getProjectTypeDropDown() {\r\n\r\n    this.spinner.show('SpinnerProject');\r\n    this.projectTypeService.getDropdownlist().subscribe((response: any) => {\r\n\r\n      if (response == null) {\r\n        this.filterProject.nid_project_type = 0;\r\n        return;\r\n      }\r\n      this.ProjectTypeDropDownList = response;\r\n      if (this.ProjectTypeDropDownList.length > 0) {\r\n        this.filterProject.nid_project_type = 0;\r\n      }\r\n      this.spinner.hide('SpinnerProject');\r\n    }, (error) => {\r\n      console.error(error);\r\n      this.spinner.hide('SpinnerProject');\r\n    });\r\n  }\r\n  pageChanged(event: any): void {\r\n    this.currentPage = event;\r\n    this.filterProject.pagination.CurrentPage = this.currentPage;\r\n    this.search();\r\n  }\r\n  thereAreProjectsLoad(): boolean {\r\n\r\n    if (typeof this.projectList === 'undefined') return false;\r\n    if (this.projectList === null) return false;\r\n    if (this.projectList.length === 0) return false;\r\n\r\n    return true;\r\n  }\r\n  ChangeRecordByPage() {\r\n    this.filterProject.pagination.ItemsPerPage = Number(this.itemsPerPage);\r\n    this.search();\r\n  }\r\n\r\n  RegistrarPago(scod, snameproject, ssname) {\r\n    this.sstatusnameSeleccionado = ssname;\r\n    this.scodprojectSeleccionado = scod;\r\n    this.snameprojectSeleccionado = snameproject;\r\n    this.titleProjectModal = 'Registrar pago';\r\n\r\n    const dialogFacturacion = this.dialog.open(RegistroPagosComponent, {\r\n      width: '1100px',\r\n      height: '90%',\r\n      autoFocus: false,\r\n      data: {\r\n        titleProjectModal: 'Registrar pago',\r\n        scodproject: this.scodprojectSeleccionado,\r\n        sstatusname: this.sstatusnameSeleccionado,\r\n        snameproject: this.snameprojectSeleccionado\r\n      },\r\n      disableClose: false,\r\n    });\r\n    dialogFacturacion.afterClosed().subscribe(data => {\r\n      // if (data != null){\r\n      this.search();\r\n      // }\r\n    })\r\n  }\r\n\r\n  closeModal() {\r\n\r\n    this.modalService.dismissAll();\r\n  }\r\n  begin() {\r\n    this.spinner.show();\r\n    this.filterProject.nid_manager = this.user.nid_person;\r\n    if (this.permisoAdministrador) {\r\n      this.filterProject.nid_manager = 0;\r\n    }\r\n    this.filterProject.nid_status = 1;\r\n    this.projectService.getprojectpagination(this.filterProject).subscribe(\r\n      (res: any) => {\r\n        try {\r\n\r\n          if (res == null) {\r\n\r\n            Swal.fire({\r\n              icon: 'error',\r\n              title: 'Ocurrió un error al obtener los registros.',\r\n              //text: 'Por favor, escríbenos a la siguiente dirección: ' +'comercial@crecerseguros.pe. Nuestro ejecutivo comercial se contactará contigo'\r\n            });\r\n          }\r\n          this.spinner.hide();\r\n\r\n          this.projectList = res.data;\r\n\r\n\r\n          this.totalItems = res.pagination.totalItems;\r\n        } catch (e) {\r\n          this.spinner.hide();\r\n          this.projectList = null;\r\n          this.totalItems = 0;\r\n        }\r\n      }\r\n    );\r\n\r\n  }\r\n}\r\n","<div class=\"app-content content bg-white\">\r\n  <div class=\"content-wrapper\">\r\n    <!-- INICIO Breadcrumbs -->\r\n    <div class=\"content-header row\">\r\n      <div class=\"content-header-left col-md-6 col-12\">\r\n        <h3 class=\"content-header-title\">{{Title}}</h3>\r\n        <div class=\"row breadcrumbs-top\">\r\n          <div class=\"breadcrumb-wrapper col-12\">\r\n            <ol class=\"breadcrumb\">\r\n              <li class=\"breadcrumb-item\"><a routerLink=\"/manage/inicio\">Inicio</a>\r\n              </li>\r\n              <li class=\"breadcrumb-item\"><a routerLink=\"/manage/facturacion-proyectos\">{{BreadLevel01}}</a>\r\n              </li>\r\n              <li class=\"breadcrumb-item active\">{{Title}}\r\n              </li>\r\n            </ol>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- FIN Breadcrumbs -->\r\n    <div class=\"content-body\">\r\n      <!-- INICIO Filtro -->\r\n      <div class=\"row\">\r\n        <div class=\"col-lg-12\">\r\n          <div class=\"card\">\r\n            <div class=\"card-header\">\r\n              <h4 class=\"card-title\"> FILTROS </h4>\r\n              <a class=\"heading-elements-toggle\"><i class=\"la la-ellipsis-v font-medium-3\"></i></a>\r\n            </div>\r\n            <div *ngIf=\"(!permisoAdministrador && !permisoJefeDeProyecto); then NoFiltro else MostrarFiltro\"></div>\r\n            <ng-template #NoFiltro>\r\n              <p style=\"padding-left: 30px;\">No hay filtros disponible para el usuario</p>\r\n            </ng-template>\r\n            <ng-template #MostrarFiltro>\r\n              <tbody>\r\n                <tr>\r\n                  <div class=\"card-content collapse show\">\r\n                    <div class=\"card-body\">\r\n                      <div class=\"form-body\">\r\n                        <div class=\"row\">\r\n                          <div class=\"form-group col-md-2 col-sm-12\">\r\n                            <label >Código Proyecto </label>\r\n                            <input type=\"text\" name=\"\" id=\"\" class=\"form-control\" [(ngModel)]=\"filterProject.scodproject\">\r\n                          </div>\r\n      \r\n                          <div *ngIf=\"permisoAdministrador; then MostrarResponsable\"></div>\r\n                          <ng-template #MostrarResponsable>\r\n                                <div class=\"form-group col-md-2 col-sm-12\">\r\n                                  <label >Responsable Proyecto</label>\r\n                                  <select class=\"select2 form-control block\"   required [(ngModel)]=\"filterProject.nid_manager\" >\r\n                                    <option value=\"0\">-- Seleccione --</option>\r\n                                    <option *ngFor=\"let item of PersonDropDownList\" [value]=\"item.code\">\r\n                                      {{item.description}}</option>\r\n                                    <span class=\"mensaje-error-control\">El campo Responsable Proyecto es obligatorio</span>\r\n                                  </select>\r\n                                </div>      \r\n                          </ng-template>\r\n\r\n                          <div class=\"form-group col-md-2 col-sm-12\">\r\n                            <label >Tipo Proyecto </label>\r\n                            <select class=\"select2 form-control block\"   required [(ngModel)]=\"filterProject.nid_project_type\" >\r\n                              <option value=\"0\">-- Seleccione --</option>\r\n                              <option *ngFor=\"let item of ProjectTypeDropDownList\" [value]=\"item.code\">\r\n                                {{item.description}}</option>\r\n                              \r\n                            </select>\r\n                          </div>\r\n      \r\n                          <div class=\"form-group col-md-4 col-sm-12\">\r\n                            <label > Cliente </label>\r\n                            <select class=\"select2 form-control block\"   required [(ngModel)]=\"filterProject.nid_client\" >\r\n                             <option value=\"0\">-- Seleccione --</option>\r\n                             <option *ngFor=\"let item of ClientDropDownList\" [value]=\"item.nid_client\">\r\n                               {{item.sname}} - {{item.sbusinessname}}</option>\r\n                             <span class=\"mensaje-error-control\">El campo Cliente es obligatorio</span>\r\n                           </select>\r\n                          </div>\r\n\r\n                          <div class=\"form-group col-md-2 col-sm-12\">\r\n                            <label > Estado </label>\r\n                            <select class=\"select2 form-control block\"   required [(ngModel)]=\"filterProject.nid_status\" >\r\n                             <option value=\"0\">-- Seleccione --</option>\r\n                             <option *ngFor=\"let item of listState\" [value]=\"item.nid_mastertable_type\">\r\n                              {{item.sshort_value}}</option>\r\n                           </select>\r\n                          </div>\r\n                          \r\n                          <div *ngIf=\"permisoConsultar\" class=\"form-group col-md-2 col-sm-12\">\r\n                            <label>&nbsp;</label>\r\n                            <div class=\"form-actions\">\r\n                              <button type=\"button\" class=\"btn btn-outline-info btn-active\" (click)=\"search()\">\r\n                                <i class=\"la la-search\"></i>&nbsp;Consultar\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div *ngIf=\"permisoConsultar\" class=\"form-group col-md-2 col-sm-12\">\r\n                            <label>&nbsp;</label>\r\n                            <div class=\"form-actions\">\r\n                              <button type=\"button\" class=\"btn btn-outline-info btn-active\" (click)=\"projectIngresosList()\">\r\n                                <i class=\"la la-search\"></i>&nbsp;Ingresos\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div *ngIf=\"permisoConsultar\" class=\"form-group col-md-2 col-sm-12\">\r\n                            <label>&nbsp;</label>\r\n                            <div class=\"form-actions\">\r\n                              <button type=\"button\" class=\"btn btn-outline-info btn-active\" (click)=\"projectGastosList()\">\r\n                                <i class=\"la la-search\"></i>&nbsp;Gastos\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </tr>\r\n              </tbody>\r\n            </ng-template>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- FIN Filtro -->\r\n      <section id=\"configuration\">\r\n        <div class=\"row\">\r\n          <div class=\"col-12\">\r\n            <div class=\"card\">\r\n              <div class=\"card-header\">\r\n                <h4 class=\"card-title\">Lista de Resultado</h4>\r\n                <a class=\"heading-elements-toggle\"><i class=\"la la-ellipsis-v font-medium-3\"></i></a>\r\n              </div>\r\n              <div class=\"card-content collapse show\">\r\n                <div class=\"card-body card-dashboard\">\r\n                  <div class=\"row\">\r\n                    \r\n                    <div class=\"form-group\" style=\"overflow-x:scroll;\">\r\n                      <div class=\"col-md-12\">\r\n                        <div class=\"table-responsive\">\r\n                          <table class=\"table table-striped table-bordered\" style=\"table-layout: fixed;\">\r\n                            <thead>\r\n                              <tr>\r\n                                \r\n                               \r\n                                <th scope=\"col\" style=\"text-align: center;width: 110px;\">Cód. Servicio</th>              \r\n                                <th scope=\"col\" style=\"text-align: center;width: 250px;\">Nombre Servicio</th>\r\n                                <th scope=\"col\" style=\"text-align: center;width: 300px;\">Cliente</th>\r\n                                <th scope=\"col\" style=\"text-align: center;width: 200px;\">Responsable</th>\r\n                                <th scope=\"col\" style=\"text-align: center;width: 110px;\">Estado</th>\r\n                                <th scope=\"col\" style=\"text-align: center;width: 110px;\">F. Registro</th>\r\n                                <th scope=\"col\" style=\"text-align: center;width: 80px;\">Acciones</th>\r\n                                \r\n                              </tr>\r\n                            </thead>\r\n                            <div *ngIf=\"!thereAreProjectsLoad(); then NoexistenRegistro  else MostrarRegistro\"></div>\r\n                            <ng-template #NoexistenRegistro>\r\n                              <tbody>\r\n                                <tr>\r\n                                  <td colspan=\"8\" style=\"text-align: center;\">No se encontraron resultados para la\r\n                                    Búsqueda</td>\r\n                                </tr>\r\n                              </tbody>\r\n                            </ng-template>\r\n                            <ng-template #MostrarRegistro>\r\n                              <tbody>\r\n                                <tr  *ngFor=\"let item of projectList; let i = index\" >\r\n                                  \r\n                                  <td class=\"width-6\" style=\"text-align: center\">{{item.scodproject}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: left\">{{item.snameproject}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: left\">{{item.sclientname}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: center\">{{item.smanagername}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: center\">{{item.sstatusname}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: center;\">{{item.sregisterdate}}</td>\r\n                                  <td class=\"width-6\" style=\"text-align: center\">\r\n                                    <a *ngIf=\"permisoRegistrarPago\"  title=\"Registrar pago\" (click)=\"RegistrarPago(item.scodproject,item.snameproject, item.sstatusname)\"> <i\r\n                                      class=\"la la-money\"></i> </a>\r\n                                  </td>\r\n                                </tr>\r\n                              </tbody>\r\n                              <br>\r\n                            </ng-template>\r\n                          </table>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"col-md-12\">\r\n                        <div class=\"row\">\r\n                          <label class=\"col-md-1\">Registros por Página</label>\r\n                          <div class=\"col-md-1\">\r\n                            <select class=\"select2 form-control input-sm\" (change)=\"ChangeRecordByPage()\"\r\n                              [(ngModel)]=\"itemsPerPage\">\r\n                              <option value=5>5</option>\r\n                              <option value=10>10</option>\r\n                              <option value=15>15</option>\r\n                              <option value=20>20</option>\r\n                            </select>\r\n                          </div>\r\n                          <div class=\"col-md-10\">\r\n                            <div class=\"d-flex justify-content-end\">\r\n                              \r\n                              <ngb-pagination [collectionSize]=\"totalItems\" [pageSize]=\"itemsPerPage\"\r\n                                [(page)]=\"currentPage\"  [rotate]=\"true\" (pageChange)=\"pageChanged($event)\">\r\n                              </ngb-pagination>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </section>\r\n      <!-- FIN Tabla Tabla Listado de Errores -->\r\n    </div>\r\n  </div>\r\n</div>\r\n<iframe id=\"ifrmTemplate\" name=\"ifrmTemplate\" style=\"display: none;\"></iframe>\r\n<a id=\"afile\" name=\"afile\" style=\"display: none;\"></a>\r\n\r\n<ngx-spinner><h1 SIZE=10 style=\"color: white;\">Cargando ...</h1></ngx-spinner>\r\n\r\n\r\n<!-- <ng-template #content2 let-modal class=\"modal-xl\">\r\n  <div class=\"modal-header\">\r\n    <h4 class=\"modal-title\">{{titleProjectModal}}</h4>\r\n  </div>\r\n  <app-registro-pagos  (projectClicked)=\"projectClicked($event)\" [scodproject]=\"scodprojectSeleccionado\" [snameproject]=\"snameprojectSeleccionado\" [sstatusname]=\"sstatusnameSeleccionado\"></app-registro-pagos>\r\n</ng-template> -->\r\n\r\n"]},"metadata":{},"sourceType":"module"}